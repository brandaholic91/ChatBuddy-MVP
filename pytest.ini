[pytest]
# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test markers
markers =
    unit: Unit tests with mocks (fast, default)
    integration: Real integration tests (slow, manual)
    e2e: End-to-end tests (very slow, CI only)
    
    # Module markers
    agents: Agent functionality tests
    agent: Single agent tests
    workflows: Workflow tests
    workflow: Single workflow tests
    integrations: Integration tests
    models: Data model tests
    utils: Utility function tests
    
    # Performance markers
    fast: Fast tests (< 1 second)
    slow: Slow tests (1-10 seconds)
    very_slow: Very slow tests (> 10 seconds)
    
    # Environment markers
    requires_openai: Requires OpenAI API key
    requires_supabase: Requires Supabase connection
    requires_redis: Requires Redis connection
    requires_internet: Requires internet connection
    
    # Legacy markers from existing tests
    ai: AI model tests
    mock: Mock tests
    async_test: Async tests
    business_logic: Business logic tests
    recommendations: Recommendation agent tests
    order_status: Order status agent tests
    marketing: Marketing agent tests
    product_info: Product info agent tests
    general: General agent tests
    tools: Tool tests
    database: Database tests
    api: API tests
    security: Security tests
    performance: Performance tests
    edge_cases: Edge case tests
    smoke: Smoke tests
    regression: Regression tests

# Coverage settings
addopts = 
    -ra
    --strict-markers
    --strict-config
    --disable-warnings
    -p no:warnings
    --tb=short
    --cov=src
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=85

# Async settings
asyncio_mode = auto
asyncio_default_fixture_loop_scope = session

# Timeout settings
timeout = 300
timeout_method = thread

# Test environment variables (handled by conftest.py and python-dotenv)
